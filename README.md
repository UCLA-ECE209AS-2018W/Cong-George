# ECE209AS Course project: House Occupacy Detection Via WiFi Packets Sniffing



## Abstract
In this paoper we have demonstrarted that we can infer the rough activity of a room/house(if there is someone at home or not) by snipping and parsing the wifi packets that are sent our by IoT devices such as Google home or Amazon Echo, and by mobile devices. We furthur demonstrated that even by parsing the informaiton contained in 802.11 frame header, we can create wifi signature of differnt device and infer the acticity within the house or home without decrypting wifi packet payload.
## Introduciton

As the concept of Internet of things are prevailing these days, more and more family choose to use them in house as a center of controll for other in-house IoT devices. For example, Google home can be associated with smart door lock or smart lamp for remote voice controll. While these devices greatly facilitate our daily life, it also exposes security issues.

To be more sepecific, devices such as Google Home, or Amazon Alexa will need to be connected to the network in order to fully enforce it's functionality. Even though nowadays the wifi packets are encrypted and are almost impossible to be decrypted, we still find a way to characterize different devices presented in the room by parsing the 802.11 frame headers which are not encrypted and can be analyzed automatically by tools such as whireshark. We demonstrate that by just using the information in the 802.11 frame header, we can form the wifi signature of differnt device. After we gathering enough informaiton and forming the signiture of each device, we can compare each new snipped wifi packet generated by unknow device and indentify possible known device by generating signatures from the new packet and compare it with exsiting signatures. Lastly, by how devices are detected within certain period, we can infer the room occupancy.   

## Background

As our approach relies on forming wifi signature from 802.11 frame heavily, we will be briefly going over the 802.11 frame header information as well as the concept of wifi signature. We assume that readers are familiar with network's osi 4-layer architecture as well as packet dumping tools such as wireshark. Also, we are assuming that readers are familiar with basic procedure of how devices can be connected to the network via access point(AP). We will also briefly introduce kali Linux operating system which is our wokring envirionment.

* **802.11 frame**    
802.11 frame is a header that is appened to the packets that are passed down from higher transport layer, information related to medium access control layer(MAC layer) will be added to the the header. All the realted data get passed down from the upper layer will be the payload of 802.11 frame and will be encrypted. However, the 802.11 frame header will not be encrypted and can be grabbed and parsed by tools such as wireshark. Let's take a look at the details of the contend of the header:  

![alt text][frame]

[frame]: https://github.com/UCLA-ECE209AS-2018W/Cong-George/blob/master/Screen%20Shot%202018-03-19%20at%201.02.36%20PM.png  

The information in the header contains both sender and receiver information as well as packet type and some other information you can refer to [this site](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc757419(v=ws.10)) for a detailed information, our approach only focuses on two specific type of packets: **probing packet(frame)** and **association packet(frame)** in MLME

* **WiFi Management Layer Identity(MLME)**  
MLME compromises a number of different types of packets with fixed parameters in 802.11 frame and are followed by other parameters suc as tagged parameters, optional fields. Also, different vendor will also add thier own parameters to the packet, which make packets sent by different devices easy of identify. Among all those MLME packets, our approach leverage the content of **Probe Frames** and **Association Frame**:  
**Probe frame**: sent by clients searching for an access point for any available AP, information included in the probe frame may be capabilites such as encodings, supported rates, authentication capabilities, supported MAC and so on.  
**Association frame**: sent by clients to ask the AP to add clients themselved to the WLAN.  
Our approach relies on these two frame to identify devices and infer house acticity.

* **WiFi Signature**  
In order for AP to handle probe and association request, AP examines the serires tagged parameters from clientsextracting those and used them as WiFi signatures. Since wifi signatures reflects a combination of the specific wifi chipset, device driver, WPA supplicant and PCB layout of the client device, they are capable of identidying differnt devices. The figure below shows the wifi signatures of differnt mobile phones.

![alt_text][frame1]

[frame1]:https://github.com/UCLA-ECE209AS-2018W/Cong-George/blob/master/sig.png  

## **Method & Implementation**
As mentioned in the previous section, the approach we are adopting is first we will collect all the packets from any devices nearby, and from the 802.11 frame we will extract probe frame and assocaition frame to form the WiFi signature and identify the devices that send out probe and association frame most frequnctly within in a period time that is sufficiently long. After we have identify those devices, we will regard a house or room being occupied when those all those devices are actively sending probe and assotiation frames.

* **Kali Linux Environment** 
* **WiFi Packets Sniffing**
* **WiFi Signature Extraction**
* **Occupancy Detection**

## **Results & Discussion**

## Future Work

## Reference


